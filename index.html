<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clayâ€™s Home Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #05060a;
      --card: #111319;
      --accent: #4ea8de;
      --accent-soft: rgba(78, 168, 222, 0.15);
      --text-main: #f5f7ff;
      --text-muted: #a3b0cf;
      --danger: #f97373;
      --radius: 16px;
      --gap: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #202538 0, #05060a 55%);
      color: var(--text-main);
      padding: 10px;
      min-height: 100vh;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--gap);
      max-width: 900px;
      margin: 0 auto;
    }

    @media (min-width: 768px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .panel {
      background: var(--card);
      border-radius: var(--radius);
      padding: 12px 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.04);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      white-space: nowrap;
    }

    /* ---------- Chores panel ---------- */
    #chores-list {
      margin-top: 4px;
      font-size: 14px;
      line-height: 1.4;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px dashed rgba(255,255,255,0.1);
      background: rgba(0,0,0,0.2);
      min-height: 80px;
      outline: none;
      white-space: pre-wrap;
    }

    #chores-list:empty::before {
      content: "Run \"Chores â€“ Today (Dashboard)\" shortcut, then tap here and Paste.";
      color: var(--text-muted);
      font-size: 12px;
    }

    /* ---------- Calendar panel ---------- */
    #calendar-status {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
      margin-bottom: 8px;
    }

    .events-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .event {
      display: grid;
      grid-template-columns: 4px 1fr;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.03);
    }

    .event-strip {
      border-radius: 999px;
      background: #4ea8de;
      margin-top: 2px;
      margin-bottom: 2px;
    }

    .event-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .event-time {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
    }

    .event-title {
      font-size: 14px;
      font-weight: 600;
    }

    .event-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .badge-warning {
      color: #fbbf24;
      background: rgba(251,191,36,0.16);
      border: 1px solid rgba(251,191,36,0.25);
    }
  </style>
</head>
<body>
  <div class="grid">
    <!-- ðŸ§¹ Chores Today -->
    <section class="panel" id="panel-chores">
      <div class="panel-header">
        <div>
          <div class="panel-title">ðŸ§¹ Chores â€“ Today</div>
          <div class="panel-subtitle">Paste from your shortcut here</div>
        </div>
        <span class="pill">Reminders</span>
      </div>
      <div id="chores-list" contenteditable="true"></div>
    </section>

    <!-- ðŸ“… Calendar (ICS auto) -->
    <section class="panel" id="panel-calendar">
      <div class="panel-header">
        <div>
          <div class="panel-title">ðŸ“… Todayâ€™s Calendar</div>
          <div class="panel-subtitle">Next 10 upcoming events</div>
        </div>
        <span class="pill badge-warning">Auto from calendars</span>
      </div>
      <div id="calendar-status">Loading from calendar feedsâ€¦</div>
      <div id="events" class="events-list"></div>
    </section>
  </div>

  <script>
    // --- Configure your calendar feeds here ---
    // I converted your webcal:// links to https:// for browser use.
    const CALENDAR_SOURCES = [
      {
        name: "Northview Production",
        color: "#f97373",
        url: "https://services.planningcenteronline.com/ical/pnb/PCn1SZowefekZeU3iF2vxiAkma54dCLV16157900.ics"
      },
      {
        name: "Church",
        color: "#facc15",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q0YaUO1QZDe4gmLOXlLi1TWR-yednb6BNOIaOq9aEtMlT73EDYcHNIoeb51S399ydA"
      },
      {
        name: "Valor",
        color: "#4ade80",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q1yHGNsKq1g960Ov-Up1IIWJ-XacYp_nfRnoszmlBtzom05C5rrFhdEMs0xWrtyVh8"
      },
      {
        name: "Life Group",
        color: "#a855f7",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q2zyOMMhsXdo-tzqj-BsPq-Won9AwAkqnzK30HR7e-B1rI6AykIG2Fkgp2djmdD-kA"
      },
      {
        name: "Vacation",
        color: "#22d3ee",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q3ap6bi9RfvGTn_1PokhNA-H12OcB87rek6Zxuc7nbzLmT46iH1Uce-WxmOt5lbjGM"
      },
      {
        name: "Credit Cards",
        color: "#fb7185",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q22wbpkHvI8CWTzGm7Afqw5JL5EyPhE2oAm2eq9M1-BxHMyPR4Gny12QyrqpY6UMV0"
      },
      {
        name: "Clay",
        color: "#38bdf8",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q2QlmZXIrLuN0elKNpjgAmDLPn_z0xmfEysJZbBprexEbSw97cbwCQOWZKcSS0aIdA"
      },
      {
        name: "Work",
        color: "#34d399",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q3sANb-uAKQtkE_6Mvi6U7p66LP2Y_L4d9QtoFJJ2Cbqj4Iva4__w7Bm7NPixYz_5Y"
      },
      {
        name: "Victoria",
        color: "#f472b6",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q1gPsCmegH7AwYgJhF7-zNDXYI-VODwbbkupDse4KapoMYLXGE6c42FLzNduJ1CpR8"
      },
      {
        name: "Family",
        color: "#eab308",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q3hppznxqTF9wqbCzSTfdI90CsV0vaW_09oBEN_ixlbxrVy-342PUtLHlmijA6UDyQ"
      },
      {
        name: "Home",
        color: "#2dd4bf",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q2apGvbY67irYJvcgjhTsFmcm-0ZQh4TdnE7KzTjuz5VLY07-OvG1APc9OOoh_bbtg"
      },
      {
        name: "Date Night",
        color: "#f97316",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q3ap2Ha5raCerQ0-pVipTMzQAGnEiTelGSAoGxmltCw2bPwVmDcWkx_-LkiSTnkMQo"
      },
      {
        name: "School",
        color: "#60a5fa",
        url: "https://p49-caldav.icloud.com/published/2/MTYxMjgyNzQxNjE2MTI4MuNg0XwuMB_4juczyi2z5Q3eAIPJBQOqyJpFWjclmR5SkZ2U8_y3agIRiR8WG5PrufbEK1djhVNPKyP12-2Hafg"
      }
    ];

    const MAX_EVENTS = 10;

    function parseICS(text, source) {
      const lines = text.split(/\r?\n/);
      const events = [];
      let current = null;

      for (let raw of lines) {
        const line = raw.trim();
        if (line === "BEGIN:VEVENT") {
          current = { calendar: source.name, color: source.color };
        } else if (line === "END:VEVENT") {
          if (current && current.start) {
            events.push(current);
          }
          current = null;
        } else if (!current) {
          continue;
        } else if (line.startsWith("SUMMARY:")) {
          current.title = line.slice(8).trim();
        } else if (line.startsWith("LOCATION:")) {
          current.location = line.slice(9).trim();
        } else if (line.startsWith("DTSTART")) {
          const value = line.split(":")[1];
          if (!value) continue;
          if (value.length === 8) {
            // DATE only, e.g. 20251205
            const y = parseInt(value.slice(0, 4), 10);
            const m = parseInt(value.slice(4, 6), 10) - 1;
            const d = parseInt(value.slice(6, 8), 10);
            current.start = new Date(y, m, d);
            current.allDay = true;
          } else {
            current.start = new Date(value);
            current.allDay = false;
          }
        } else if (line.startsWith("DTEND")) {
          const value = line.split(":")[1];
          if (!value) continue;
          if (value.length === 8) {
            const y = parseInt(value.slice(0, 4), 10);
            const m = parseInt(value.slice(4, 6), 10) - 1;
            const d = parseInt(value.slice(6, 8), 10);
            current.end = new Date(y, m, d);
          } else {
            current.end = new Date(value);
          }
        }
      }

      return events;
    }

    function formatEventTime(date, allDay) {
      if (!date) return "";
      if (allDay) return "All-day";

      const opts = { weekday: "short", hour: "numeric", minute: "2-digit" };
      return date.toLocaleString(undefined, opts);
    }

    function formatMeta(e) {
      const parts = [];
      if (e.location) parts.push(e.location);
      if (e.calendar) parts.push(e.calendar);
      return parts.join(" â€¢ ");
    }

    function renderEvents(events) {
      const statusEl = document.getElementById("calendar-status");
      const container = document.getElementById("events");
      container.innerHTML = "";

      if (!events.length) {
        statusEl.textContent = "No upcoming events found.";
        return;
      }

      statusEl.textContent = "";
      events.forEach(e => {
        const wrapper = document.createElement("div");
        wrapper.className = "event";

        const strip = document.createElement("div");
        strip.className = "event-strip";
        strip.style.background = e.color || "#4ea8de";

        const main = document.createElement("div");
        main.className = "event-main";

        const time = document.createElement("div");
        time.className = "event-time";
        time.textContent = formatEventTime(e.start, e.allDay);

        const title = document.createElement("div");
        title.className = "event-title";
        title.textContent = e.title || "(No title)";

        main.appendChild(time);
        main.appendChild(title);

        const metaText = formatMeta(e);
        if (metaText) {
          const meta = document.createElement("div");
          meta.className = "event-meta";
          meta.textContent = metaText;
          main.appendChild(meta);
        }

        wrapper.appendChild(strip);
        wrapper.appendChild(main);
        container.appendChild(wrapper);
      });
    }

    async function loadCalendars() {
      const statusEl = document.getElementById("calendar-status");
      let allEvents = [];

      const startOfToday = new Date();
      startOfToday.setHours(0,0,0,0);

      for (const source of CALENDAR_SOURCES) {
        try {
          const res = await fetch(source.url);
          if (!res.ok) {
            console.warn("Fetch failed", source.name, res.status);
            continue;
          }
          const text = await res.text();
          const events = parseICS(text, source);
          events.forEach(e => {
            if (e.start && e.start >= startOfToday) {
              allEvents.push(e);
            }
          });
        } catch (err) {
          console.warn("Error fetching/parsing calendar", source.name, err);
        }
      }

      allEvents.sort((a, b) => a.start - b.start);
      renderEvents(allEvents.slice(0, MAX_EVENTS));

      // If still empty, likely CORS / server restriction
      if (!allEvents.length) {
        statusEl.textContent = "Could not load calendars (some servers block web access).";
      }
    }

    document.addEventListener("DOMContentLoaded", loadCalendars);
  </script>
</body>
</html>
